---
title: 
description: 
keywords: 
search.product: eADQiWindows 10XVcnh
ms.pagetype: security
ms.prod: w10
ms.mktglfcycl: manage
ms.sitesec: library
ms.pagetype: security
localizationpriority: medium
author: iaanw
ms.author: iawilt
---

# Evaluate Attack Surface Reduction rules


Attack Surface Reduction is a feature that is part of Windows Defender Exploit Guard [that helps prevent actions and apps that are typically used by exploit-seeking malware to infect machines](attack-surface-reduction-exploit-guard.md). 

This topic helps you evaluate Attack Surface Reduction. It explains how to demo the feature using a specialized tool, and how to enable audit mode so you can test the feature directly in your organisation.

>[NOTE]
>This topic uses PowerShell cmdlets to make it easy to enable the feature and test it. 
>For instructions on how to use Group Policy, Mobile Device Management (MDM), and System Center Configuration Manager to deploy these settings across your network, see the main [Attack Surface Reduction topic](attack-surface-reduction-exploit-guard.md).


## Use the demo tool to see how Attack Surface Reduction works

Use the **ExploitGuard ASR test tool** app to see how Attack Surface Reduction rules are applied in certain key protection and high-risk scenarios. These scenarios are typical infection vectors for malware that use exploits to spread and infect machines.

The tool is part of the Windows Defender Exploit Guard evaluation package:
- [Download the Exploit Guard Evaluation Package](#)

This tool has a simple user interface that lets you choose a rule, configure it in blocking, auditing, or disabled mode, and run a pre-created series of actions that would be evaluated by the rule.

You can also set advanced options, including setting a delay, choosing a specific scenario, and how to view a record of the events.

When you run a scenario, you will see what the scenario entails, what the rule is set to, and what actions were taken.

![](images/asr-test-tool.png)


### Rule 1



### Rule 2



### Rule 3



### Rule 4



### Rule 5



### Rule 6










## Review Attack Surface Reduction events in Windows Event Viewer

You can also review the Windows event log to see the events there were created when using the tool:

1. Type **Event viewer** in the Start menu to open the Windows Event Viewer.

2. On the left panel, under **Actions**, click **Import custom view...**

3. Navigate to the Exploit Guard Evaluation Package, and select the file *asr-events.xml*. Alternatively, [download the XML directly](scripts/asr-events.xml).

4. Click **OK**.

5. This will create a custom view that filters to only show the following events related to Attack Surface Reduction:

 Event ID | Description
-|-
5007 | Event when settings are changed
1122 | Event when rule fires in Audit-mode 
1121 | Event when rule fires in Block-mode 


## Use auditing mode to measure impact

You can also enable the Attack Surface Reduction feature in auditing mode. This lets you see a record of what apps would have been blocked if you had enabled the feature.

You might want to do this when testing how the feature will work in your organization, to ensure it doesn't affect your line-of-business apps, and to get an idea of how often the rules will fire during normal use.

To enable audit mode, use the following PowerShell cmdlet:

```PowerShell
Set-MpPreference -AttackSurfaceReductionRules_Actions AuditMode
```


>[!TIP]
>If you want to fully audit how Attack Surface Redurction will work in your organization, you'll need to use a management tool to deploy this setting to machines in your network(s).
You can also use Group Policy, Intune, MDM, or System Center Configuration Manager to configure and deploy the setting, as described in the main [Attack Surface Reduction topic](attack-surface-reduction-exploit-guard.md).



## Customize Attack Surface Reduction

During your evaluation, you may wish to configure each rule individualy or exclude certain files and processes from being evaluated by the feature.

See the following sections in the main [Use Attack Surface Reduction rules](controlled-folders-exploit-guard.md) topic for configuring the feature with MDM policies, PowerShell, the Windows Defender Security Center, Group Policy, Intune, or System Center Configuration Manager: 

- [Exclude files and folders](attack-surface-reduction-exploit-guard.md#exclude-files-and-folders)
- [Configure rules individually](attack-surface-reduction-exploit-guard.md#configure-rules-individually)















## Attack Surface Reduction rules 




### Audit/block modes

Each of these components can individually be enabled in audit or blocking mode. 

Attack Surface Reduction and Controlled Folder Access also have mitigations that can be individually enabled in audit or blocking mode. 

Component  |Description |Rule/mitigation description |
-|-|-|-
Attack Surface Reduction (ASR) | Provides rules that allow you to prevent macro, script and email threats. - Each rule can be enabled in audit/block mode - Supports file/folder exclusions applied to all rules |Rules to prevent macro threats |Block office application from creating executable content
| | | | Block obfuscated js/vbs/ps/macro code
| | | | Block office application from launching child processes
| | | | Block office application from injecting into other processes
| | | | Block Win32 imports from macro code in Office
| | | Rules to prevent script threats |Block js/vbs from executing payload downloaded from Internet
| | | | Block obfuscated js/vbs/ps/macro code
| | | Rules to prevent email threats |Block execution of executable content (exe, dll, ps, js, vbs, etc) dropped from email (webmail/mail-client).


## Policy settings for Windows Defender EG

The MDM policy settings for Windows Defender EG are listed in this section, along with example settings. 


### Attack Surface Reduction 

- ./Vendor/MSFT/Policy/Config/Defender/AttackSurfaceReductionOnlyExclusions
- ./Vendor/MSFT/Policy/Config/Defender/AttackSurfaceReductionRules  
-- Value as String Data Type : {75668C1F-73B5-4CF0-BB93-3ECF5CB7CC84}:1 
  

#### Rule-GUIDs for ASR

Rule description | GUIDs 
-|-
Office rules | 
Block office application from injecting into other processes | {75668c1f-73b5-4cf0-bb93-3ecf5cb7cc84}
 | OMA URI : “./Vendor/MSFT/Policy/Config/Defender/AttackSurfaceReductionRules”
 | Value as String Data Type : {75668C1F-73B5-4CF0-BB93-3ECF5CB7CC84}:1 
 | 1 = Block, 2 = Audit, 0 = Disabled.
Block office application/macros from creating executable content  | {3b576869-a4ec-4529-8536-b80a7769e899}
 | Replace the above GUID with the corresponding Rule GUID
Block office application from launching child processes | {d4f940ab-401b-4efc-aadc-ad5f3c50688a}
 | Replace the above GUID with the corresponding Rule GUID
Block Win32 imports from Macro code in Office | {92E97FA1-2EDF-4476-BDD6-9DD0B4DDDC7B}
  | Replace the above GUID with the corresponding Rule GUID
Block obfuscated js/vbs/ps/macro code  | {5beb7efe-fd9a-4556-801d-275e5ffc04cc}
 | Replace the above GUID with the corresponding Rule GUID
Script rules | 
Block obfuscated js/vbs/ps/macro code  | {5beb7efe-fd9a-4556-801d-275e5ffc04cc}
 | Replace the above GUID with the corresponding Rule GUID [Note: same rule as above, but also covers scripts hence written here]
Block js/vbs from executing payload downloaded from Internet. | {d3e037e1-3eb8-44c8-a917-57927947596d}
 | Replace the above GUID with the corresponding Rule GUID
Email rule | 
Block execution of executable content (exe, dll, ps, js, vbs, etc) dropped from email (webmail/mail-client). | be9ba2d9-53ea-4cdc-84e5-9b1eeee46550
 | Replace the above GUID with the corresponding Rule GUID [Currently working for Mail-client (Outlook). Personal Webmail (Outlook.com, Gmail, Yahoo) work in progress]



 ## Evaluate

### Using the standalone configuration tool 

We’ve provided an easy-to-use configuration tool for testing purposes, called TestHIPS. The tool can be used to:

1. Enable the chosen ASR rule in either block or audit mode by creating a local GPO and running a test file that triggers the rule.

2. Enable the chosen ASR rule in either block or audit mode by creating a local GPO. 

The result of the activity can be viewed in the event log and corresponding notification (if the rule was triggered in block mode). 

You can find the tool in the evaluation package alongside this guide:
- ExploitGuardCustomerFiles/AntiMalware.Tools.TestHIPS.exe
- 
Note: You may need to change the extension in the filename from **AntiMalware.Tools.TestHIPS.rename** to **AntiMalware.Tools.TestHIPS.exe**.

For additional help with the tool, use the “-?” parameter.
 

### Using the DemoExploitGuard tool to simulate WD-EG Rules with a GUI

You can use an additional tool, called DemoExploitGuard, to test various rules by simulating scenarios that would cause the rule to issue a block or audit event, depending on the mode. DemoExploitGuard uses the TestHIPS tool to enable and configure the rules.

You can find the tool in the evaluation package alongside this guide:
- ExploitGuardCustomerFiles\AntiMalware.Tools.DemoExploitGuard.exe

Note: You may need to change the extension in the filename from **AntiMalware.Tools.DemoExploitGuard.rename** to **AntiMalware.Tools.DemoExploitGuard.exe**
**Rules**: Select one of the seven Attack Surface Reduction rules to run.
**Mode**: Sets the behavior of the Demo Tool. 
Note: If the rule is applied by GP, this should not be an option
- **Disabled**: This scenario will execute normally and complete
- **Block**: This scenario should get blocked [ExploitGuard Block] and a notification will appear to indicate the block
- **Audit**: This scenario will not block, but will show up in the event log. Right-click the output area to go directly to the event logs for Windows Defender EG
  

### Manually enabling the Attack Surface Reduction rules

You can also manually use GP or MDM-URIs to enable the ASR rules:

From the rules tables above, choose the ASR rules that you want to enable and set the following policy. For each rule select the right GUID.

After you’ve chosen your rules, use one of the tools above to simulate a rule to fire.
- “./Vendor/MSFT/Policy/Config/Defender/AttackSurfaceReductionRules”
- Value as String Data Type: {75668C1F-73B5-4CF0-BB93-3ECF5CB7CC84}:2
 

### View event logs

Note: event logs are not the primary mechanism for investigation. The Windows Defender ATP portal receives much richer information that allows for investigation. Information is also presented in an interactive machine-timeline view.


#### Event fields
- **ID**: matches with the Rule-ID that triggered the block/audit.
- **Detection time**: Time of detection
- **Process Name**: The process that performed the “operation” that was blocked/audited
- **Description**: 

Windows Defender Antivirus has audited an operation that is not allowed by your IT administrator.

For more information please contact your IT administrator.
-- ID: D4F940AB-401B-4EFC-AADC-AD5F3C50688A
-- Detection time: 2017-06-21T11:52:29.062Z
-- User: SYSTEM
-- Path: C:\Windows\System32\notepad.exe
-- Process Name: C:\Program Files\Microsoft Office\Office16\winword.exe
-- Signature Version: 1.245.730.0
-- Engine Version: 1.1.13902.0
-- Product Version: 4.12.16228.1000


### View the alert notification

If you configure the test to block, a notification will be displayed from the Action Center.  This notification is customizable with your organization and contact information.
 

### Customizing Windows Defender

Customizing the Windows Defender Security Center is a simple task that provides users with a clear way to contact support.
Simply navigate in Group Policy to **Computer Configuration\Administrative Templates\Windows Components\Windows Defender Security Center\Enterprise Customization**. From there, you will be able to enable your custom notification, set your organization name and contact information.